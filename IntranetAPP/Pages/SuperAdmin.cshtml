@page
@model IntranetAPP.Pages.SuperAdminModel
@{
}
<head>
    <script>
        function activate()
        {
            checkUserPriviliges();
            setLoginData();
            getPriviliges();
            checkIfCorrectPrivilige("SuperAdmin", "Niepoprawne uprawnienia do wykonania akcji.");
        }
        
        function getPriviliges()
        {
            $.get("http://localhost:5249/GetPriviliges", function (data){
                if (data.statusCode != undefined && data.statusCode == 404) {
                    return;
                }
                else
                {
                    const select_elem = document.getElementById('newPriviliges');
                    data.forEach(d => select_elem.add(new Option(d.name, d.id)));
                }
            });
        }

        function addNewUser()
        {
            var email = document.getElementById("newEmail").value;
            var password = document.getElementById("newPass").value;
            var password2 = document.getElementById("newPass2").value;
            var username = document.getElementById("newUsername").value;
            var surname = document.getElementById("newSurname").value;
            var priviliges = document.getElementById("newPriviliges").value;

            var message = document.getElementById("message");
            message.innerText = "";
            message.style.color = "red";

            if (email == "" || email == undefined || email == null) {
                message.innerText = "Pole email nie może być puste";
                return;
            }

            if (password == "" || password == undefined || password == null) {
                message.innerText = "Pole hasło nie może być puste";
                return;
            }

            if (password != password2)
            {
                message.innerText = "Hasła muszą się identyczne";
                return;
            }

            if (username == "" || username == undefined || username == null) {
                message.innerText = "Pole imię nie może być puste";
                return;
            }

            if (surname == "" || surname == undefined || surname == null) {
                message.innerText = "Pole nazwisko nie może być puste";
                return;
            }

            if (priviliges == "" || priviliges == undefined || priviliges == null) {
                message.innerText = "Należy wybrać uprawnienia";
                return;
            }

            var body = {
                email: email,
                password: password,
                username: username,
                surname: surname,
                priviliges: priviliges
            };

            $.post("http://localhost:5249/AddNewUser", body, function (data){
                if (data.statusCode == 200)
                {
                    document.getElementById("newEmail").value = "";
                    document.getElementById("newPass").value = "";
                    document.getElementById("newPass2").value = "";
                    document.getElementById("newUsername").value = "";
                    document.getElementById("newSurname").value = "";
                    document.getElementById("newPriviliges").selectedIndex = 0;

                    message.style.color = "green";
                    message.innerText = data.message;
                }
                else
                {
                    message.innerText = "Wystąpił nieoczekiwany błąd";
                }
            });
        }
    </script>
</head>

<body onload="activate()">
    <div class="container">
        <h2>Dodanie nowego użytkownika</h2>
        <div>
            <table>
                <tbody>
                    <tr>
                        <td>
                            <label for="newEmail">Email: </label>
                        </td>
                        <td>
                            <input id="newEmail" />
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <label for="newPass">Hasło: </label>
                        </td>
                        <td>
                            <input id="newPass" type="password" />
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <label for="newPass2">Powtórz hasło: </label>
                        </td>
                        <td>
                            <input id="newPass2" type="password" />
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <label for="newUsername">Imię: </label>
                        </td>
                        <td>
                            <input id="newUsername" />
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <label for="newSurname">Nazwisko: </label>
                        </td>
                        <td>
                            <input id="newSurname" />
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <label for="newPriviliges">Uprawnienia: </label>
                        </td>
                        <td>
                            <select style="width: 100%" id="newPriviliges"></select>
                        </td>
                    </tr>
                </tbody>
            </table>
            <button id="addNewUser" onclick="addNewUser()">Dodaj nowego użytkownika</button>
            <div>
                <span id="message"></span>
            </div>
        </div>
    </div>
</body>